!function(){L.drawLocal.draw.toolbar.imports||(L.drawLocal.draw.toolbar.imports={}),L.Draw.Imports=L.Draw.Feature.extend({statics:{FORMATS:[],TYPE:"imports"},initialize:function(t,e){this.type=L.Draw.Imports.TYPE,L.Draw.Feature.prototype.initialize.call(this,t,e)},getActions:function(){return L.Draw.Imports.FORMATS.map(function(t){var e=null;return t.createActionElement&&(e=t.createActionElement.call(this)),{enabled:!0,title:t.title,text:t.text,callback:t.callback,context:this,ownElement:e}},this)}})}(),function(){L.drawLocal.draw.toolbar.imports.shapeZip||(L.drawLocal.draw.toolbar.imports.shapeZip={text:"Import a shapefile zip",title:"Please, select a zip file."}),ShpZipFormat={_handlers:{},_nextId:1,createOpenButton:function(){var t=L.DomUtil.create("a");t.style.position="relative",t.innerHTML=L.drawLocal.draw.toolbar.imports.shapeZip.text,t.title=L.drawLocal.draw.toolbar.imports.shapeZip.title;var e=L.DomUtil.create("input","leaflet-draw-draw-imports-action",t);e.type="file";var r=this;return e.onchange=function(){ShpZipFormat._openShapeZip(r,e)},t},nop:function(){},_getWorker:function(){if(!this._worker){if(!L.Draw.Imports.SHPJS_URL)throw new Error("Need shapefile-js URL");var t="try { importScripts('"+L.Draw.Imports.SHPJS_URL+"'); } catch (e) {console.error(e); throw e;}\nonmessage = function(e) {\nconsole.log('Processing ShapeZip...');\nvar geoJSON = shp.parseZip(e.data.byteArray);\nconsole.log('ShapeZip processed!');\npostMessage({id: e.data.id, geoJSON: geoJSON});\n}",e=URL.createObjectURL(new Blob([t],{type:"application/javascript"}));this._worker=new Worker(e),this._worker.onmessage=this._onmessage.bind(this),this._worker.onerror=function(){console.log(arguments)}}return this._worker},_onmessage:function(t){var e,r,i,a,o,n=t.data.geoJSON,s=this._handlers[t.data.id];n.features.forEach(function(t){if(e=t.properties,r=t.geometry,r.type.startsWith("Multi"))for(a=0;a<r.coordinates.length;a++)i={type:r.type.substring(5),properties:e,coordinates:r.coordinates[a]},o=L.GeoJSON.geometryToLayer(i),s._fireCreatedEvent(o);else o=L.GeoJSON.geometryToLayer(t),s._fireCreatedEvent(o);s.disable()})},_openShapeZip:function(t,e){if(e.files||e.files[0]){var r=new FileReader;r.onload=function(){2===r.readyState&&r.result&&ShpZipFormat._parse(t,r.result)},t._map.fire("draw:importstart"),r.readAsArrayBuffer(e.files[0])}},_parse:function(t,e){var r=this._getWorker(),i=this._nextId++;this._handlers[i]=t,r.postMessage({id:i,byteArray:e},[e])}},L.Draw.Imports.FORMATS.push({callback:ShpZipFormat.nop,createActionElement:ShpZipFormat.createOpenButton})}(),function(){var t="within";L.FeatureGroup.Validation=L.Handler.extend({includes:L.Mixin.Events,options:{},initialize:function(t){this._featureGroup=t,this._binded={},this._errors={}},addHooks:function(){this._withins&&(this._withins.forEach(this._watch.bind(this,t)),this._featureGroup.on("layeradd layerremove",this._getHandler(this._validateMe,t)))},fireOnMap:function(t,e){this._featureGroup._map&&this._featureGroup._map.fire(t,e)},removeHooks:function(){this._withins&&(this._featureGroup.off("layeradd layerremove",this._getHandler(this._validateMe,t)),this._unwithin())},within:function(){return this._unwithin(),this._withins=Array.prototype.slice.call(arguments,0),this},_getHandler:function(t,e){var r=L.stamp(t);return this._binded[e]||(this._binded[e]={}),this._binded[e][r]||(this._binded[e][r]=t.bind(this,e)),this._binded[e][r]},_validate:function(t,e){if(this._featureGroup.getLayers().length){var r=L.stamp(e.target);if(this._featureGroup[t](e.target)){if(this._errors[t]){var i=this._errors[t].indexOf(r);i>-1&&(this._errors[t].splice(i,1),0===this._errors[t].length&&(e={validation:t,targetLayer:this._featureGroup},this.fire("valid",e),this.fireOnMap("draw:valid",e)))}}else this._errors[t]||(this._errors[t]=[]),-1===this._errors[t].indexOf(r)&&this._errors[t].push(r),e={validation:t,targetLayer:this._featureGroup,sourceLayer:e.target},this.fire("invalid",e),this.fireOnMap("draw:invalid",e)}},_validateMe:function(t){var e,r=!0;if(this._errors[t]&&this._errors[t].length&&(r=!1),this._errors[t]=[],!this._featureGroup.getLayers().length)return void(r||(e={validation:t,targetLayer:this._featureGroup},this.fire("valid",e),this.fireOnMap("draw:valid",e)));var i=this["_"+t+"s"];i&&(e={validation:t,targetLayer:this._featureGroup},i.forEach(function(r){this._featureGroup[t](r)||(this._errors[t].push(L.stamp(r)),e.sourceLayer=r,this.fire("invalid",e),this.fireOnMap("draw:invalid",e))},this),this._errors[t].length||r||(e={validation:t,targetLayer:this._featureGroup},this.fire("valid",e),this.fireOnMap("draw:valid",e)))},_onLayerPreAdd:function(t,e){},_onLayerRemove:function(t,e){},_onLayerPreRemove:function(t,e){},_unwithin:function(){this._withins&&(this._withins.forEach(this._unwatch.bind(this,t)),delete this._withins)},_unwatch:function(t,e){var r=this._getHandler(this._validate,t);e.off("layeradd",r),e.off("layerremove",r)},_watch:function(t,e){var r=this._getHandler(this._validate,t);e.on("layeradd",r),e.on("layerremove",r)}}),L.FeatureGroup.addInitHook(function(){this.validation||(this.validation=new L.FeatureGroup.Validation(this))})}();